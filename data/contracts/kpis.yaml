# AtlasMesh Fleet OS - Key Performance Indicators
# This file defines all KPIs referenced throughout the system
# Each KPI has a unique ID, description, measurement method, and thresholds

# Global KPIs (cross-sector)
global:
  # Safety KPIs
  safety:
    zero_harm:
      id: "global.safety.zero_harm"
      description: "Zero harm incidents involving autonomous vehicles"
      measurement: "count of safety incidents per operational hour"
      threshold:
        target: 0
        warning: 0
        critical: ">0"
      alert_channel: "safety-critical"
      
    assists_per_distance:
      id: "global.safety.assists_per_distance"
      description: "Frequency of human tele-assist Q&A interventions"
      measurement: "count of assists per 1000 km traveled"
      threshold:
        target: 0.3
        warning: 0.5
        critical: 0.7
      alert_channel: "operations"
      
    safe_stops_per_distance:
      id: "global.safety.safe_stops_per_distance"
      description: "Frequency of autonomous safe-stop events"
      measurement: "count of safe-stops per 10000 km traveled"
      threshold:
        target: 1.0
        warning: 2.0
        critical: 5.0
      alert_channel: "operations"
      
  # Reliability KPIs
  reliability:
    fleet_availability:
      id: "global.reliability.fleet_availability"
      description: "Percentage of fleet available for operations"
      measurement: "100 * (operational_hours / (operational_hours + downtime_hours))"
      threshold:
        target: 99.5
        warning: 98.0
        critical: 95.0
      alert_channel: "fleet-health"
      
    mission_completion:
      id: "global.reliability.mission_completion"
      description: "Percentage of missions completed successfully"
      measurement: "100 * (completed_missions / total_missions)"
      threshold:
        target: 98.5
        warning: 97.0
        critical: 95.0
      alert_channel: "operations"
      
    odd_conformance:
      id: "global.reliability.odd_conformance"
      description: "Percentage of operations within defined ODD"
      measurement: "100 * (in_odd_time / total_operation_time)"
      threshold:
        target: 99.9
        warning: 99.5
        critical: 99.0
      alert_channel: "safety-critical"
      
  # Economic KPIs
  economic:
    roi_months:
      id: "global.economic.roi_months"
      description: "Months to positive return on investment"
      measurement: "initial_investment / monthly_savings"
      threshold:
        target: 18
        warning: 24
        critical: 30
      alert_channel: "business"
      
  # Operational KPIs
  operational:
    dispatch_latency:
      id: "global.operational.dispatch_latency"
      description: "Time from request to vehicle assignment"
      measurement: "P95 of (assignment_time - request_time) in seconds"
      threshold:
        target: 5.0
        warning: 10.0
        critical: 30.0
      alert_channel: "operations"
      
    energy_efficiency:
      id: "global.operational.energy_efficiency"
      description: "Energy consumption per distance traveled"
      measurement: "kWh or L per km"
      threshold:
        target: "baseline * 0.85"  # 15% improvement
        warning: "baseline * 0.95"
        critical: "baseline * 1.0"
      alert_channel: "fleet-health"

# Defense Sector KPIs
defense:
  mission_completion:
    id: "defense.mission_completion"
    description: "Percentage of defense missions completed successfully"
    measurement: "100 * (completed_missions / total_missions)"
    threshold:
      target: 98.0
      warning: 97.0
      critical: 95.0
    alert_channel: "operations"
    
  gnss_denied_localization:
    id: "defense.gnss_denied_localization"
    description: "Percentage of GNSS-denied segments with maintained localization"
    measurement: "100 * (successful_localization_time / gnss_denied_time)"
    threshold:
      target: 99.0
      warning: 97.0
      critical: 95.0
    alert_channel: "safety-critical"
    
  tele_assist_turnaround:
    id: "defense.tele_assist_turnaround"
    description: "Time from tele-assist request to resolution"
    measurement: "P95 of (resolution_time - request_time) in seconds"
    threshold:
      target: 2.0
      warning: 3.0
      critical: 5.0
    alert_channel: "operations"
    
  crypto_attestation:
    id: "defense.crypto_attestation"
    description: "Cryptographic attestation success rate"
    measurement: "100 * (successful_attestations / total_attestation_attempts)"
    threshold:
      target: 100.0
      warning: 99.9
      critical: 99.0
    alert_channel: "security"

# Mining Sector KPIs
mining:
  tons_per_hour:
    id: "mining.tons_per_hour"
    description: "Tons moved per operational hour"
    measurement: "total_tons / operational_hours"
    threshold:
      target: "baseline * 1.10"  # 10% improvement
      warning: "baseline * 1.05"
      critical: "baseline * 1.0"
    alert_channel: "operations"
    
  assists_per_distance:
    id: "mining.assists_per_distance"
    description: "Frequency of human tele-assist Q&A interventions in mining operations"
    measurement: "count of assists per 1000 km traveled"
    threshold:
      target: 0.2
      warning: 0.3
      critical: 0.5
    alert_channel: "operations"
    
  fleet_availability:
    id: "mining.fleet_availability"
    description: "Percentage of mining fleet available for operations"
    measurement: "100 * (operational_hours / (operational_hours + downtime_hours))"
    threshold:
      target: 99.5
      warning: 98.0
      critical: 95.0
    alert_channel: "fleet-health"
    
  maintenance_cost_reduction:
    id: "mining.maintenance_cost_reduction"
    description: "Percentage reduction in maintenance costs through PdM"
    measurement: "100 * (1 - (current_maintenance_cost / baseline_maintenance_cost))"
    threshold:
      target: 25.0
      warning: 15.0
      critical: 10.0
    alert_channel: "fleet-health"
    
  dust_occlusion_assists:
    id: "mining.dust_occlusion_assists"
    description: "Assists due to dust occlusion in low visibility"
    measurement: "assists per 1000 km in visibility < Vmin"
    threshold:
      target: "baseline * 0.7"  # 30% reduction
      warning: "baseline * 0.8"
      critical: "baseline * 0.9"
    alert_channel: "operations"
    
  heat_derating_impact:
    id: "mining.heat_derating_impact"
    description: "Impact of heat on production rate"
    measurement: "slope of tons/hour vs ambient temp curve"
    threshold:
      target: -0.1  # minimal impact
      warning: -0.3
      critical: -0.5
    alert_channel: "fleet-health"
    
  pdm_accuracy:
    id: "mining.pdm_accuracy"
    description: "Accuracy of predictive maintenance models"
    measurement: "precision and recall for top 10 failure modes"
    threshold:
      target: 0.8  # both precision and recall
      warning: 0.7
      critical: 0.6
    alert_channel: "fleet-health"

# Logistics Sector KPIs
logistics:
  on_time_yard_moves:
    id: "logistics.on_time_yard_moves"
    description: "Percentage of yard moves completed on time"
    measurement: "100 * (on_time_moves / total_moves)"
    threshold:
      target: 95.0
      warning: 90.0
      critical: 85.0
    alert_channel: "operations"
    
  empty_miles_percentage:
    id: "logistics.empty_miles_percentage"
    description: "Percentage of miles traveled without cargo"
    measurement: "100 * (empty_miles / total_miles)"
    threshold:
      target: 3.0
      warning: 5.0
      critical: 10.0
    alert_channel: "operations"
    
  energy_cost_reduction:
    id: "logistics.energy_cost_reduction"
    description: "Percentage reduction in energy costs"
    measurement: "100 * (1 - (current_energy_cost / baseline_energy_cost))"
    threshold:
      target: 12.5  # midpoint of 10-15%
      warning: 7.5
      critical: 5.0
    alert_channel: "fleet-health"
    
  gate_turnaround_variance:
    id: "logistics.gate_turnaround_variance"
    description: "Variance in gate turnaround time"
    measurement: "P95 - P50 of gate_turnaround_time in seconds"
    threshold:
      target: 90
      warning: 120
      critical: 180
    alert_channel: "operations"
    
  wms_integration_accuracy:
    id: "logistics.wms_integration_accuracy"
    description: "Accuracy of WMS/TOS integration"
    measurement: "100 * (successful_integrations / total_integration_attempts)"
    threshold:
      target: 99.9
      warning: 99.5
      critical: 99.0
    alert_channel: "operations"
    
  miss_spot_rate:
    id: "logistics.miss_spot_rate"
    description: "Rate of incorrectly spotted trailers/containers"
    measurement: "100 * (miss_spots / total_spots)"
    threshold:
      target: 0.5
      warning: 1.0
      critical: 2.0
    alert_channel: "operations"

# Ride-hail Sector KPIs
ride_hail:
  wait_time:
    id: "ride_hail.wait_time"
    description: "Rider wait time from request to pickup"
    measurement: "P95 of (pickup_time - request_time) in minutes"
    threshold:
      target: 7.0
      warning: 10.0
      critical: 15.0
    alert_channel: "operations"
    
  customer_satisfaction:
    id: "ride_hail.customer_satisfaction"
    description: "Rider satisfaction rating"
    measurement: "Average rating on 1-5 scale"
    threshold:
      target: 4.8
      warning: 4.5
      critical: 4.2
    alert_channel: "operations"
    
  zero_harm_incidents:
    id: "ride_hail.zero_harm_incidents"
    description: "Safety incidents involving riders"
    measurement: "count of safety incidents per 10000 rides"
    threshold:
      target: 0
      warning: 0
      critical: ">0"
    alert_channel: "safety-critical"
    
  assists_per_distance:
    id: "ride_hail.assists_per_distance"
    description: "Frequency of human tele-assist Q&A interventions in ride-hail"
    measurement: "count of assists per 1000 km traveled"
    threshold:
      target: 0.5
      warning: 0.7
      critical: 1.0
    alert_channel: "operations"
    
  assisted_events_csat:
    id: "ride_hail.assisted_events_csat"
    description: "Customer satisfaction on trips with assist events"
    measurement: "Average rating on 1-5 scale for trips with assists"
    threshold:
      target: 4.6
      warning: 4.3
      critical: 4.0
    alert_channel: "operations"
    
  construction_related_assists:
    id: "ride_hail.construction_related_assists"
    description: "Quarter-over-quarter reduction in construction-related assists"
    measurement: "100 * (1 - (current_quarter_assists / previous_quarter_assists))"
    threshold:
      target: 40.0
      warning: 30.0
      critical: 20.0
    alert_channel: "operations"
    
  ada_fulfillment:
    id: "ride_hail.ada_fulfillment"
    description: "Fulfillment rate for accessibility ride requests"
    measurement: "100 * (fulfilled_ada_requests / total_ada_requests)"
    threshold:
      target: 98.0
      warning: 95.0
      critical: 90.0
    alert_channel: "operations"

# Use case specific KPIs

# D1 - Autonomous FOB Resupply Convoy
d1_autonomous_fob_resupply:
  mission_completion:
    id: "d1.mission_completion"
    description: "Percentage of FOB resupply missions completed successfully"
    measurement: "100 * (completed_missions / total_missions)"
    threshold:
      target: 98.0
      warning: 97.0
      critical: 95.0
    alert_channel: "operations"
    
  assists_per_distance:
    id: "d1.assists_per_distance"
    description: "Frequency of human tele-assist Q&A interventions in convoy operations"
    measurement: "count of assists per 1000 km traveled"
    threshold:
      target: 0.3
      warning: 0.5
      critical: 0.7
    alert_channel: "operations"
    
  tele_assist_turnaround:
    id: "d1.tele_assist_turnaround"
    description: "Time from convoy tele-assist request to resolution"
    measurement: "P95 of (resolution_time - request_time) in seconds"
    threshold:
      target: 2.0
      warning: 3.0
      critical: 5.0
    alert_channel: "operations"
    
  tamper_events:
    id: "d1.tamper_events"
    description: "Security tamper events detected during convoy operations"
    measurement: "count of tamper events per mission"
    threshold:
      target: 0
      warning: 0
      critical: ">0"
    alert_channel: "security"

# M1 - Pit-to-Crusher Autonomous Haul
m1_pit_to_crusher:
  tons_per_hour:
    id: "m1.tons_per_hour"
    description: "Tons moved per operational hour in pit-to-crusher operations"
    measurement: "total_tons / operational_hours"
    threshold:
      target: "baseline * 1.10"  # 10% improvement
      warning: "baseline * 1.05"
      critical: "baseline * 1.0"
    alert_channel: "operations"
    
  assists_per_distance:
    id: "m1.assists_per_distance"
    description: "Frequency of human tele-assist Q&A interventions in haul operations"
    measurement: "count of assists per 1000 km traveled"
    threshold:
      target: 0.2
      warning: 0.3
      critical: 0.5
    alert_channel: "operations"
    
  fleet_availability:
    id: "m1.fleet_availability"
    description: "Percentage of haul truck fleet available for operations"
    measurement: "100 * (operational_hours / (operational_hours + downtime_hours))"
    threshold:
      target: 99.5
      warning: 98.0
      critical: 95.0
    alert_channel: "fleet-health"
    
  cost_per_ton:
    id: "m1.cost_per_ton"
    description: "Cost per ton reduction compared to manual operation"
    measurement: "100 * (1 - (autonomous_cost_per_ton / manual_cost_per_ton))"
    threshold:
      target: 13.0
      warning: 10.0
      critical: 5.0
    alert_channel: "operations"

# L1 - Yard Switcher: Dock ↔ Yard Slot Shuttling
l1_yard_switcher:
  gate_to_dock_time:
    id: "l1.gate_to_dock_time"
    description: "Time from gate to dock in yard operations"
    measurement: "P95 of (dock_time - gate_time) in minutes"
    threshold:
      target: "baseline * 0.75"  # 25% improvement
      warning: "baseline * 0.85"
      critical: "baseline * 0.95"
    alert_channel: "operations"
    
  miss_spot_rate:
    id: "l1.miss_spot_rate"
    description: "Rate of incorrectly spotted trailers/containers"
    measurement: "100 * (miss_spots / total_spots)"
    threshold:
      target: 0.5
      warning: 1.0
      critical: 2.0
    alert_channel: "operations"
    
  safety_incidents:
    id: "l1.safety_incidents"
    description: "Safety incidents in yard operations"
    measurement: "count of safety incidents per 1000 moves"
    threshold:
      target: 0
      warning: 0
      critical: ">0"
    alert_channel: "safety-critical"
    
  throughput_increase:
    id: "l1.throughput_increase"
    description: "Increase in yard move throughput vs. manual operation"
    measurement: "100 * ((autonomous_moves_per_hour / manual_moves_per_hour) - 1)"
    threshold:
      target: 20.0  # midpoint of 15-25%
      warning: 15.0
      critical: 10.0
    alert_channel: "operations"

# R1 - Standard Point-to-Point Ride
r1_point_to_point:
  wait_time:
    id: "r1.wait_time"
    description: "Rider wait time from request to pickup"
    measurement: "P95 of (pickup_time - request_time) in minutes"
    threshold:
      target: 7.0
      warning: 10.0
      critical: 15.0
    alert_channel: "operations"
    
  customer_satisfaction:
    id: "r1.customer_satisfaction"
    description: "Rider satisfaction rating"
    measurement: "Average rating on 1-5 scale"
    threshold:
      target: 4.8
      warning: 4.5
      critical: 4.2
    alert_channel: "operations"
    
  cancellation_rate:
    id: "r1.cancellation_rate"
    description: "Rate of ride cancellations"
    measurement: "100 * (cancelled_rides / total_ride_requests)"
    threshold:
      target: 5.0
      warning: 7.5
      critical: 10.0
    alert_channel: "operations"
    
  assists_per_distance:
    id: "r1.assists_per_distance"
    description: "Frequency of human tele-assist Q&A interventions in ride-hail"
    measurement: "count of assists per 1000 km traveled"
    threshold:
      target: 0.5
      warning: 0.7
      critical: 1.0
    alert_channel: "operations"
