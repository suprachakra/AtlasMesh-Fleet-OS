graph TB
    %% AtlasMesh Fleet OS - API Topology Diagram
    %% Generated from: OpenAPI specifications and service dependencies
    %% Version 1.0 | Integration contracts and API relationships
    
    %% External Clients
    WebUI[ğŸ–¥ï¸ Control Center UI<br/>React SPA]
    MobileApp[ğŸ“± Mobile App<br/>React Native]
    ThirdParty[ğŸ”— Third Party<br/>Integrators]
    
    %% API Gateway (Entry Point)
    APIGateway[ğŸšª API Gateway<br/>Port: 8080<br/>Go + Gin]
    
    %% Core Services with APIs
    FleetMgr[ğŸš› Fleet Manager<br/>Port: 8081<br/>REST + gRPC]
    VehicleGW[ğŸš— Vehicle Gateway<br/>Port: 8082<br/>WebSocket + REST]
    PolicyEngine[ğŸ“‹ Policy Engine<br/>Port: 8083<br/>gRPC + REST]
    AuthService[ğŸ” Auth Service<br/>Port: 8084<br/>REST + JWT]
    
    %% Data Services
    TelemetryIngest[ğŸ“¡ Telemetry Ingest<br/>Port: 8085<br/>gRPC + Kafka]
    Analytics[ğŸ“Š Analytics Engine<br/>Port: 8086<br/>REST + GraphQL]
    DataLineage[ğŸ” Data Lineage<br/>Port: 8087<br/>REST + Neo4j]
    
    %% AI/ML Services
    MLPipeline[ğŸ§  ML Pipeline<br/>Port: 8088<br/>REST + MLflow]
    PredMaint[ğŸ”§ Predictive Maintenance<br/>Port: 8089<br/>gRPC + TensorFlow]
    DigitalTwin[ğŸ­ Digital Twin<br/>Port: 8090<br/>REST + CARLA]
    
    %% Integration Services
    UAEGov[ğŸ‡¦ğŸ‡ª UAE Government<br/>Port: 8091<br/>REST + SOAP]
    WeatherFusion[ğŸŒ¤ï¸ Weather Fusion<br/>Port: 8092<br/>REST + HTTP]
    MapContract[ğŸ—ºï¸ Map Data Contract<br/>Port: 8093<br/>REST + PostGIS]
    
    %% Infrastructure Services
    EventBus[ğŸ“¨ Event Bus<br/>Kafka Cluster<br/>Ports: 9092-9094]
    Monitoring[ğŸ“ˆ Monitoring<br/>Prometheus: 9090<br/>Grafana: 3000]
    
    %% External Systems
    UAEGovSys[ğŸ›ï¸ UAE Government<br/>Systems]
    WeatherAPI[ğŸŒ Weather APIs<br/>Multi-source]
    MapProviders[ğŸ—ºï¸ Map Providers<br/>HD Maps]
    
    %% Client to API Gateway
    WebUI -->|HTTPS/REST<br/>JWT Auth| APIGateway
    MobileApp -->|HTTPS/REST<br/>OAuth 2.0| APIGateway
    ThirdParty -->|HTTPS/REST<br/>API Keys| APIGateway
    
    %% API Gateway to Core Services
    APIGateway -->|gRPC<br/>Service Mesh| FleetMgr
    APIGateway -->|gRPC + WebSocket<br/>Real-time| VehicleGW
    APIGateway -->|gRPC<br/>Policy Eval| PolicyEngine
    APIGateway -->|gRPC<br/>Token Validation| AuthService
    
    %% API Gateway to Data Services
    APIGateway -->|gRPC<br/>Telemetry Query| TelemetryIngest
    APIGateway -->|REST + GraphQL<br/>Analytics| Analytics
    APIGateway -->|REST<br/>Lineage Query| DataLineage
    
    %% API Gateway to AI/ML Services
    APIGateway -->|REST<br/>Model Management| MLPipeline
    APIGateway -->|gRPC<br/>Maintenance Pred| PredMaint
    APIGateway -->|REST<br/>Simulation| DigitalTwin
    
    %% API Gateway to Integration Services
    APIGateway -->|REST<br/>Compliance| UAEGov
    APIGateway -->|REST<br/>Weather Data| WeatherFusion
    APIGateway -->|REST<br/>Map Updates| MapContract
    
    %% Inter-Service Communication
    FleetMgr -->|gRPC<br/>Policy Check| PolicyEngine
    FleetMgr -->|gRPC<br/>Vehicle Status| VehicleGW
    FleetMgr -->|Kafka<br/>Fleet Events| EventBus
    
    VehicleGW -->|Kafka<br/>Telemetry Stream| TelemetryIngest
    VehicleGW -->|Kafka<br/>Command Events| EventBus
    VehicleGW -->|WebSocket<br/>Vehicle Comms| VehicleGW
    
    TelemetryIngest -->|Kafka<br/>Processed Data| Analytics
    TelemetryIngest -->|gRPC<br/>Data Lineage| DataLineage
    
    Analytics -->|REST<br/>ML Features| MLPipeline
    MLPipeline -->|gRPC<br/>Trained Models| PredMaint
    PredMaint -->|gRPC<br/>Maintenance Alerts| FleetMgr
    
    %% External Integrations
    UAEGov -->|HTTPS/REST<br/>Gov APIs| UAEGovSys
    WeatherFusion -->|HTTPS/REST<br/>Weather APIs| WeatherAPI
    MapContract -->|HTTPS/REST<br/>Map APIs| MapProviders
    
    %% Monitoring Integration
    Monitoring -->|HTTP<br/>Metrics Scraping| APIGateway
    Monitoring -->|HTTP<br/>Health Checks| FleetMgr
    Monitoring -->|HTTP<br/>Service Metrics| VehicleGW
    Monitoring -->|JMX<br/>Kafka Metrics| EventBus
    
    %% API Specifications
    subgraph "API Specifications"
        FleetAPI[ğŸ“„ Fleet Manager API<br/>OpenAPI 3.0<br/>/api/fleet/openapi.yaml]
        VehicleAPI[ğŸ“„ Vehicle Gateway API<br/>OpenAPI 3.0<br/>/api/vehicle/openapi.yaml]
        PolicyAPI[ğŸ“„ Policy Engine API<br/>OpenAPI 3.0<br/>/api/policy/openapi.yaml]
        AuthAPI[ğŸ“„ Auth Service API<br/>OpenAPI 3.0<br/>/api/auth/openapi.yaml]
        TelemetryAPI[ğŸ“„ Telemetry API<br/>OpenAPI 3.0<br/>/api/telemetry/openapi.yaml]
        AnalyticsAPI[ğŸ“„ Analytics API<br/>OpenAPI 3.0<br/>GraphQL Schema]
    end
    
    %% gRPC Contracts
    subgraph "gRPC Contracts"
        FleetProto[ğŸ“‹ fleet_manager.proto<br/>Service Definitions]
        PolicyProto[ğŸ“‹ policy_engine.proto<br/>Policy Evaluation]
        TelemetryProto[ğŸ“‹ telemetry.proto<br/>Data Ingestion]
        PredMaintProto[ğŸ“‹ predictive_maintenance.proto<br/>ML Predictions]
    end
    
    %% Event Schemas
    subgraph "Event Schemas"
        VehicleEvents[ğŸ“¨ vehicle-events-v1.avsc<br/>Avro Schema]
        CommandEvents[ğŸ“¨ command-events-v1.avsc<br/>Avro Schema]
        TelemetryEvents[ğŸ“¨ telemetry-events-v1.avsc<br/>Avro Schema]
        FleetEvents[ğŸ“¨ fleet-events-v1.avsc<br/>Avro Schema]
    end
    
    %% API Versioning Strategy
    subgraph "API Versioning"
        V1[ğŸ”¢ v1 APIs<br/>Current Stable<br/>Backward Compatible]
        V2[ğŸ”¢ v2 APIs<br/>Future Version<br/>Breaking Changes]
        Deprecation[âš ï¸ Deprecation Policy<br/>6 months notice<br/>Migration guides]
    end
    
    %% Security Layers
    subgraph "Security"
        JWT[ğŸ”‘ JWT Tokens<br/>RS256 Signing<br/>Short Expiration]
        OAuth[ğŸ” OAuth 2.0<br/>Authorization Code<br/>PKCE for Mobile]
        APIKeys[ğŸ—ï¸ API Keys<br/>Third Party Access<br/>Rate Limited]
        mTLS[ğŸ”’ mTLS<br/>Service-to-Service<br/>Certificate Auth]
    end
    
    %% Rate Limiting
    subgraph "Rate Limiting"
        UserLimits[ğŸ‘¤ User Limits<br/>1000 req/min<br/>Per JWT token]
        ServiceLimits[âš™ï¸ Service Limits<br/>10000 req/min<br/>Per service]
        ThirdPartyLimits[ğŸ”— 3rd Party Limits<br/>100 req/min<br/>Per API key]
    end
    
    %% API Gateway Features
    subgraph "Gateway Features"
        LoadBalancing[âš–ï¸ Load Balancing<br/>Round Robin<br/>Health Checks]
        CircuitBreaker[ğŸ”Œ Circuit Breaker<br/>Fail Fast<br/>Auto Recovery]
        RequestLogging[ğŸ“ Request Logging<br/>Audit Trail<br/>Performance Metrics]
        CORS[ğŸŒ CORS Policy<br/>Allowed Origins<br/>Preflight Handling]
    end
    
    %% Styling
    classDef client fill:#e1f5fe,stroke:#01579b,stroke-width:2px
    classDef gateway fill:#fff3e0,stroke:#e65100,stroke-width:3px
    classDef coreService fill:#e8f5e8,stroke:#2e7d32,stroke-width:2px
    classDef dataService fill:#f3e5f5,stroke:#7b1fa2,stroke-width:2px
    classDef mlService fill:#fff8e1,stroke:#f57f17,stroke-width:2px
    classDef integration fill:#fce4ec,stroke:#c2185b,stroke-width:2px
    classDef infrastructure fill:#f1f8e9,stroke:#558b2f,stroke-width:2px
    classDef external fill:#fafafa,stroke:#616161,stroke-width:2px
    classDef spec fill:#e3f2fd,stroke:#1565c0,stroke-width:1px
    
    class WebUI,MobileApp,ThirdParty client
    class APIGateway gateway
    class FleetMgr,VehicleGW,PolicyEngine,AuthService coreService
    class TelemetryIngest,Analytics,DataLineage dataService
    class MLPipeline,PredMaint,DigitalTwin mlService
    class UAEGov,WeatherFusion,MapContract integration
    class EventBus,Monitoring infrastructure
    class UAEGovSys,WeatherAPI,MapProviders external
    class FleetAPI,VehicleAPI,PolicyAPI,AuthAPI,TelemetryAPI,AnalyticsAPI spec
