# AtlasMesh Fleet OS - Comprehensive Kafka Topic Definitions
# Event-driven architecture backbone for autonomous vehicle operations

# Topic Naming Convention: {domain}.{entity}.{event_type}
# Partitioning Strategy: By vehicle_id, tenant_id, or geographic_region
# Retention: Based on compliance requirements and operational needs

topics:
  # === VEHICLE TELEMETRY STREAMS ===
  vehicle.telemetry.raw:
    partitions: 32
    replication_factor: 3
    retention_ms: 604800000  # 7 days
    compression_type: "lz4"
    cleanup_policy: "delete"
    min_insync_replicas: 2
    description: "Raw vehicle telemetry data from edge agents"
    schema_registry:
      key_schema: "vehicle-id-v1"
      value_schema: "vehicle-telemetry-v1"
    partitioning_strategy: "vehicle_id"
    
  vehicle.telemetry.processed:
    partitions: 16
    replication_factor: 3
    retention_ms: 2592000000  # 30 days
    compression_type: "snappy"
    cleanup_policy: "delete"
    min_insync_replicas: 2
    description: "Processed and validated vehicle telemetry"
    schema_registry:
      key_schema: "vehicle-id-v1"
      value_schema: "vehicle-telemetry-processed-v1"
    partitioning_strategy: "vehicle_id"
    
  vehicle.commands.outbound:
    partitions: 16
    replication_factor: 3
    retention_ms: 86400000  # 1 day
    compression_type: "snappy"
    cleanup_policy: "delete"
    min_insync_replicas: 2
    description: "Commands sent to vehicles"
    schema_registry:
      key_schema: "vehicle-id-v1"
      value_schema: "vehicle-command-v1"
    partitioning_strategy: "vehicle_id"
    
  vehicle.commands.acknowledgments:
    partitions: 16
    replication_factor: 3
    retention_ms: 86400000  # 1 day
    compression_type: "snappy"
    cleanup_policy: "delete"
    min_insync_replicas: 2
    description: "Command acknowledgments from vehicles"
    schema_registry:
      key_schema: "command-id-v1"
      value_schema: "command-acknowledgment-v1"
    partitioning_strategy: "vehicle_id"

  # === FLEET OPERATIONS ===
  fleet.trips.lifecycle:
    partitions: 8
    replication_factor: 3
    retention_ms: 7776000000  # 90 days
    compression_type: "snappy"
    cleanup_policy: "delete"
    min_insync_replicas: 2
    description: "Trip lifecycle events (created, assigned, started, completed, cancelled)"
    schema_registry:
      key_schema: "trip-id-v1"
      value_schema: "trip-lifecycle-event-v1"
    partitioning_strategy: "trip_id"
    
  fleet.dispatch.events:
    partitions: 8
    replication_factor: 3
    retention_ms: 2592000000  # 30 days
    compression_type: "snappy"
    cleanup_policy: "delete"
    min_insync_replicas: 2
    description: "Dispatch decisions and vehicle assignments"
    schema_registry:
      key_schema: "dispatch-id-v1"
      value_schema: "dispatch-event-v1"
    partitioning_strategy: "geographic_region"
    
  fleet.routing.updates:
    partitions: 8
    replication_factor: 3
    retention_ms: 604800000  # 7 days
    compression_type: "snappy"
    cleanup_policy: "delete"
    min_insync_replicas: 2
    description: "Route calculations and updates"
    schema_registry:
      key_schema: "route-id-v1"
      value_schema: "route-update-v1"
    partitioning_strategy: "geographic_region"

  # === SAFETY & ALERTS ===
  safety.alerts.critical:
    partitions: 4
    replication_factor: 3
    retention_ms: 31536000000  # 1 year
    compression_type: "snappy"
    cleanup_policy: "delete"
    min_insync_replicas: 2
    description: "Critical safety alerts requiring immediate attention"
    schema_registry:
      key_schema: "alert-id-v1"
      value_schema: "safety-alert-v1"
    partitioning_strategy: "severity_level"
    
  safety.policy.violations:
    partitions: 8
    replication_factor: 3
    retention_ms: 31536000000  # 1 year
    compression_type: "snappy"
    cleanup_policy: "delete"
    min_insync_replicas: 2
    description: "Policy violations and compliance events"
    schema_registry:
      key_schema: "violation-id-v1"
      value_schema: "policy-violation-v1"
    partitioning_strategy: "policy_type"
    
  safety.incidents.reports:
    partitions: 4
    replication_factor: 3
    retention_ms: 157680000000  # 5 years (regulatory requirement)
    compression_type: "snappy"
    cleanup_policy: "delete"
    min_insync_replicas: 2
    description: "Safety incident reports and investigations"
    schema_registry:
      key_schema: "incident-id-v1"
      value_schema: "incident-report-v1"
    partitioning_strategy: "incident_severity"

  # === MAINTENANCE & OPERATIONS ===
  maintenance.predictive.alerts:
    partitions: 4
    replication_factor: 3
    retention_ms: 7776000000  # 90 days
    compression_type: "snappy"
    cleanup_policy: "delete"
    min_insync_replicas: 2
    description: "Predictive maintenance alerts and RUL predictions"
    schema_registry:
      key_schema: "vehicle-id-v1"
      value_schema: "maintenance-alert-v1"
    partitioning_strategy: "vehicle_id"
    
  maintenance.work.orders:
    partitions: 4
    replication_factor: 3
    retention_ms: 31536000000  # 1 year
    compression_type: "snappy"
    cleanup_policy: "delete"
    min_insync_replicas: 2
    description: "Maintenance work orders and completion status"
    schema_registry:
      key_schema: "work-order-id-v1"
      value_schema: "work-order-v1"
    partitioning_strategy: "facility_id"

  # === WEATHER & ENVIRONMENT ===
  weather.conditions.updates:
    partitions: 8
    replication_factor: 3
    retention_ms: 604800000  # 7 days
    compression_type: "lz4"
    cleanup_policy: "delete"
    min_insync_replicas: 2
    description: "Weather condition updates from multiple sources"
    schema_registry:
      key_schema: "location-id-v1"
      value_schema: "weather-update-v1"
    partitioning_strategy: "geographic_region"
    
  weather.alerts.severe:
    partitions: 4
    replication_factor: 3
    retention_ms: 2592000000  # 30 days
    compression_type: "snappy"
    cleanup_policy: "delete"
    min_insync_replicas: 2
    description: "Severe weather alerts affecting operations"
    schema_registry:
      key_schema: "alert-id-v1"
      value_schema: "weather-alert-v1"
    partitioning_strategy: "geographic_region"

  # === SYSTEM EVENTS ===
  system.audit.logs:
    partitions: 8
    replication_factor: 3
    retention_ms: 157680000000  # 5 years (compliance)
    compression_type: "snappy"
    cleanup_policy: "delete"
    min_insync_replicas: 2
    description: "System audit logs for compliance and security"
    schema_registry:
      key_schema: "audit-id-v1"
      value_schema: "audit-log-v1"
    partitioning_strategy: "service_name"
    
  system.metrics.aggregated:
    partitions: 4
    replication_factor: 3
    retention_ms: 2592000000  # 30 days
    compression_type: "lz4"
    cleanup_policy: "delete"
    min_insync_replicas: 2
    description: "Aggregated system metrics and KPIs"
    schema_registry:
      key_schema: "metric-id-v1"
      value_schema: "metric-aggregate-v1"
    partitioning_strategy: "metric_type"

  # === DEAD LETTER QUEUES ===
  dlq.vehicle.telemetry:
    partitions: 4
    replication_factor: 3
    retention_ms: 604800000  # 7 days
    compression_type: "snappy"
    cleanup_policy: "delete"
    min_insync_replicas: 2
    description: "Failed vehicle telemetry messages for manual review"
    schema_registry:
      key_schema: "error-id-v1"
      value_schema: "dlq-message-v1"
    partitioning_strategy: "error_type"
    
  dlq.fleet.operations:
    partitions: 4
    replication_factor: 3
    retention_ms: 604800000  # 7 days
    compression_type: "snappy"
    cleanup_policy: "delete"
    min_insync_replicas: 2
    description: "Failed fleet operation messages"
    schema_registry:
      key_schema: "error-id-v1"
      value_schema: "dlq-message-v1"
    partitioning_strategy: "error_type"
    
  dlq.safety.alerts:
    partitions: 2
    replication_factor: 3
    retention_ms: 2592000000  # 30 days
    compression_type: "snappy"
    cleanup_policy: "delete"
    min_insync_replicas: 2
    description: "Failed safety alert messages - high priority for review"
    schema_registry:
      key_schema: "error-id-v1"
      value_schema: "dlq-message-v1"
    partitioning_strategy: "error_type"

  # === FEATURE FLAGS & EXPERIMENTS ===
  features.flag.evaluations:
    partitions: 4
    replication_factor: 3
    retention_ms: 604800000  # 7 days
    compression_type: "snappy"
    cleanup_policy: "delete"
    min_insync_replicas: 2
    description: "Feature flag evaluation events for analytics"
    schema_registry:
      key_schema: "evaluation-id-v1"
      value_schema: "flag-evaluation-v1"
    partitioning_strategy: "flag_key"
    
  features.experiments.results:
    partitions: 4
    replication_factor: 3
    retention_ms: 7776000000  # 90 days
    compression_type: "snappy"
    cleanup_policy: "delete"
    min_insync_replicas: 2
    description: "A/B test and experiment results"
    schema_registry:
      key_schema: "experiment-id-v1"
      value_schema: "experiment-result-v1"
    partitioning_strategy: "experiment_id"

# Topic Groups for Management
topic_groups:
  vehicle_operations:
    - vehicle.telemetry.raw
    - vehicle.telemetry.processed
    - vehicle.commands.outbound
    - vehicle.commands.acknowledgments
    
  fleet_management:
    - fleet.trips.lifecycle
    - fleet.dispatch.events
    - fleet.routing.updates
    
  safety_compliance:
    - safety.alerts.critical
    - safety.policy.violations
    - safety.incidents.reports
    
  maintenance_operations:
    - maintenance.predictive.alerts
    - maintenance.work.orders
    
  environmental_data:
    - weather.conditions.updates
    - weather.alerts.severe
    
  system_observability:
    - system.audit.logs
    - system.metrics.aggregated
    
  dead_letter_queues:
    - dlq.vehicle.telemetry
    - dlq.fleet.operations
    - dlq.safety.alerts
    
  feature_management:
    - features.flag.evaluations
    - features.experiments.results

# Environment-specific overrides
environments:
  development:
    default_partitions: 2
    default_replication_factor: 1
    default_retention_ms: 86400000  # 1 day
    
  staging:
    default_partitions: 4
    default_replication_factor: 2
    default_retention_ms: 604800000  # 7 days
    
  production:
    default_partitions: 8
    default_replication_factor: 3
    # Use topic-specific retention settings
