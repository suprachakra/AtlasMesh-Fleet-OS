graph TB
    %% AtlasMesh Fleet OS - Vehicle Telemetry Data Flow
    %% HIGH PRIORITY: Real-time telemetry processing and analytics pipeline
    %% Version 1.0 | Generated from: Kafka topics + service specs | Performance: 10Hz per vehicle
    
    %% Vehicle Sources
    Vehicle1[ğŸš— Vehicle AV-001<br/>Sensors + ROS2]
    Vehicle2[ğŸš— Vehicle AV-002<br/>Sensors + ROS2]
    VehicleN[ğŸš— Vehicle AV-N<br/>1000+ Vehicles]
    
    %% Edge Processing
    EdgeAgent1[ğŸ¤– Vehicle Agent<br/>ROS2 + Edge Compute]
    EdgeAgent2[ğŸ¤– Vehicle Agent<br/>ROS2 + Edge Compute]
    EdgeAgentN[ğŸ¤– Vehicle Agent<br/>ROS2 + Edge Compute]
    
    %% Fleet Communication
    VehicleGateway[ğŸŒ Vehicle Gateway<br/>WebSocket Server<br/>Port: 8082]
    
    %% Message Queue
    KafkaCluster[ğŸ“¨ Kafka Cluster<br/>Topics: vehicle.telemetry.*<br/>Partitioned by vehicle_id]
    
    %% Stream Processing
    TelemetryIngest[ğŸ“¡ Telemetry Ingest<br/>Go + Kafka Streams<br/>Real-time Processing]
    
    %% Data Storage
    ClickHouse[ğŸï¸ ClickHouse<br/>Hot Path Analytics<br/>Real-time Queries]
    TimescaleDB[â° TimescaleDB<br/>Time-series Storage<br/>Historical Data]
    MinIO[ğŸ—„ï¸ MinIO<br/>Cold Storage<br/>Raw Telemetry Archive]
    
    %% Analytics & ML
    AnalyticsEngine[ğŸ“Š Analytics Engine<br/>Real-time Dashboards<br/>Fleet Insights]
    MLPipeline[ğŸ§  ML Pipeline<br/>Feature Engineering<br/>Model Training]
    PredictiveMaint[ğŸ”§ Predictive Maintenance<br/>RUL Prediction<br/>Anomaly Detection]
    
    %% Monitoring & Alerts
    Monitoring[ğŸ“ˆ Monitoring Stack<br/>Prometheus + Grafana<br/>System Health]
    AlertManager[ğŸš¨ Alert Manager<br/>Threshold Alerts<br/>Anomaly Alerts]
    
    %% Control Center
    ControlCenter[ğŸ–¥ï¸ Control Center UI<br/>Real-time Dashboards<br/>Fleet Operations]
    
    %% External Systems
    UAEGov[ğŸ›ï¸ UAE Government<br/>Compliance Reporting<br/>Safety Data]
    WeatherService[ğŸŒ¤ï¸ Weather Fusion<br/>Environmental Context<br/>Multi-source Data]
    
    %% === TELEMETRY COLLECTION ===
    
    Vehicle1 -->|"CAN Bus + Ethernet<br/>Sensor Data<br/>1000Hz"| EdgeAgent1
    Vehicle2 -->|"CAN Bus + Ethernet<br/>Sensor Data<br/>1000Hz"| EdgeAgent2
    VehicleN -->|"CAN Bus + Ethernet<br/>Sensor Data<br/>1000Hz"| EdgeAgentN
    
    %% Edge Processing
    EdgeAgent1 -->|"ROS2 Topics<br/>Aggregated Telemetry<br/>10Hz"| EdgeAgent1
    EdgeAgent2 -->|"ROS2 Topics<br/>Aggregated Telemetry<br/>10Hz"| EdgeAgent2
    EdgeAgentN -->|"ROS2 Topics<br/>Aggregated Telemetry<br/>10Hz"| EdgeAgentN
    
    %% Vehicle to Fleet Communication
    EdgeAgent1 -->|"WebSocket<br/>JSON Telemetry<br/>10Hz"| VehicleGateway
    EdgeAgent2 -->|"WebSocket<br/>JSON Telemetry<br/>10Hz"| VehicleGateway
    EdgeAgentN -->|"WebSocket<br/>JSON Telemetry<br/>10Hz"| VehicleGateway
    
    %% === STREAM PROCESSING ===
    
    VehicleGateway -->|"Kafka Producer<br/>Avro Messages<br/>Topic: vehicle.telemetry.{id}"| KafkaCluster
    
    KafkaCluster -->|"Kafka Consumer<br/>Batch Processing<br/>1000 msg/sec"| TelemetryIngest
    
    %% Data Enrichment
    WeatherService -->|"Weather Context<br/>Environmental Data<br/>1Hz"| TelemetryIngest
    
    %% === DATA STORAGE ===
    
    TelemetryIngest -->|"Real-time Insert<br/>Columnar Storage<br/>Hot Data"| ClickHouse
    TelemetryIngest -->|"Time-series Insert<br/>Hypertables<br/>Compressed"| TimescaleDB
    TelemetryIngest -->|"Raw Archive<br/>Parquet Files<br/>Cold Storage"| MinIO
    
    %% === ANALYTICS & ML ===
    
    ClickHouse -->|"Real-time Queries<br/>Aggregations<br/>Sub-second"| AnalyticsEngine
    TimescaleDB -->|"Historical Queries<br/>Time-series Analysis<br/>Trends"| AnalyticsEngine
    
    ClickHouse -->|"Feature Extraction<br/>ML Training Data<br/>Batch"| MLPipeline
    MLPipeline -->|"Trained Models<br/>Inference Pipeline<br/>Real-time"| PredictiveMaint
    
    PredictiveMaint -->|"Maintenance Alerts<br/>RUL Predictions<br/>Anomalies"| AlertManager
    
    %% === MONITORING & ALERTING ===
    
    TelemetryIngest -->|"Processing Metrics<br/>Throughput, Latency<br/>1Hz"| Monitoring
    ClickHouse -->|"Query Performance<br/>Storage Metrics<br/>1Hz"| Monitoring
    KafkaCluster -->|"Topic Metrics<br/>Consumer Lag<br/>1Hz"| Monitoring
    
    Monitoring -->|"Threshold Alerts<br/>System Health<br/>Real-time"| AlertManager
    AnalyticsEngine -->|"Business Alerts<br/>Fleet KPIs<br/>Real-time"| AlertManager
    
    %% === USER INTERFACES ===
    
    AnalyticsEngine -->|"Real-time Data<br/>WebSocket<br/>Dashboard Updates"| ControlCenter
    AlertManager -->|"Alert Notifications<br/>WebSocket<br/>Urgent Alerts"| ControlCenter
    
    %% === EXTERNAL REPORTING ===
    
    TimescaleDB -->|"Compliance Data<br/>Safety Reports<br/>Daily"| UAEGov
    AnalyticsEngine -->|"Fleet Statistics<br/>Operational Reports<br/>Hourly"| UAEGov
    
    %% === DATA FLOW ANNOTATIONS ===
    
    subgraph "Edge Processing Layer"
        EdgeAgent1
        EdgeAgent2
        EdgeAgentN
        note1[ğŸ“ Edge Processing:<br/>â€¢ Sensor fusion<br/>â€¢ Data compression<br/>â€¢ Local filtering<br/>â€¢ Bandwidth optimization]
    end
    
    subgraph "Communication Layer"
        VehicleGateway
        KafkaCluster
        note2[ğŸ“ Communication:<br/>â€¢ WebSocket for real-time<br/>â€¢ Kafka for reliability<br/>â€¢ Avro for schema evolution<br/>â€¢ Partitioning by vehicle_id]
    end
    
    subgraph "Stream Processing Layer"
        TelemetryIngest
        note3[ğŸ“ Stream Processing:<br/>â€¢ Real-time validation<br/>â€¢ Data enrichment<br/>â€¢ Format conversion<br/>â€¢ Quality scoring]
    end
    
    subgraph "Storage Layer"
        ClickHouse
        TimescaleDB
        MinIO
        note4["ğŸ“ Storage Strategy:<br>&bull; Hot: ClickHouse (7 days)<br>&bull; Warm: TimescaleDB (90 days)<br>&bull; Cold: MinIO (7 years)<br>&bull; Automatic tiering"]
    end
    
    subgraph "Analytics Layer"
        AnalyticsEngine
        MLPipeline
        PredictiveMaint
        note5[ğŸ“ Analytics:<br/>â€¢ Real-time dashboards<br/>â€¢ Predictive models<br/>â€¢ Anomaly detection<br/>â€¢ Fleet optimization]
    end
    
    %% === PERFORMANCE REQUIREMENTS ===
    
    subgraph "Performance SLAs"
        perf1[ğŸ“Š Throughput:<br/>â€¢ 1000 vehicles Ã— 10Hz = 10K msg/sec<br/>â€¢ Peak: 50K msg/sec<br/>â€¢ Kafka: 1M msg/sec capacity]
        perf2[âš¡ Latency:<br/>â€¢ Edge to Gateway: <100ms<br/>â€¢ Gateway to Storage: <500ms<br/>â€¢ Query Response: <1s]
        perf3[ğŸ’¾ Storage:<br/>â€¢ Hot data: 7 days Ã— 10TB/day = 70TB<br/>â€¢ Warm data: 90 days Ã— 1TB/day = 90TB<br/>â€¢ Cold archive: 7 years Ã— 100GB/day = 256TB]
    end
    
    %% === DATA QUALITY & GOVERNANCE ===
    
    subgraph "Data Quality"
        quality1["âœ… Validation:<br>&bull; Schema validation (Avro)<br>&bull; Range checks<br>&bull; Timestamp validation<br>&bull; Duplicate detection"]
        quality2[ğŸ” Monitoring:<br/>â€¢ Data freshness<br/>â€¢ Completeness<br/>â€¢ Accuracy scores<br/>â€¢ Drift detection]
        quality3[ğŸ›¡ï¸ Privacy:<br/>â€¢ PII redaction<br/>â€¢ Data residency<br/>â€¢ Retention policies<br/>â€¢ Access controls]
    end
    
    %% Styling
    classDef vehicle fill:#ff6b6b,stroke:#d63031,stroke-width:2px,color:#fff
    classDef edge fill:#74b9ff,stroke:#0984e3,stroke-width:2px,color:#fff
    classDef communication fill:#ffeaa7,stroke:#fdcb6e,stroke-width:2px
    classDef processing fill:#55a3ff,stroke:#2d3436,stroke-width:2px,color:#fff
    classDef storage fill:#fd79a8,stroke:#e84393,stroke-width:2px,color:#fff
    classDef analytics fill:#00b894,stroke:#00a085,stroke-width:2px,color:#fff
    classDef monitoring fill:#e17055,stroke:#d63031,stroke-width:2px,color:#fff
    classDef external fill:#636e72,stroke:#2d3436,stroke-width:2px,color:#fff
    classDef ui fill:#a29bfe,stroke:#6c5ce7,stroke-width:2px,color:#fff
    
    class Vehicle1,Vehicle2,VehicleN vehicle
    class EdgeAgent1,EdgeAgent2,EdgeAgentN edge
    class VehicleGateway,KafkaCluster communication
    class TelemetryIngest processing
    class ClickHouse,TimescaleDB,MinIO storage
    class AnalyticsEngine,MLPipeline,PredictiveMaint analytics
    class Monitoring,AlertManager monitoring
    class UAEGov,WeatherService external
    class ControlCenter ui
