---
title: Trip Lifecycle - Complete Flow - AtlasMesh Fleet OS
---
sequenceDiagram
    participant UI as Control Center UI
    participant AG as API Gateway
    participant TS as Mission Management
    participant DS as Dispatch Service
    participant PE as Policy Engine
    participant RS as Routing Service
    participant FM as Fleet Manager
    participant VA as Vehicle Agent
    participant TI as Telemetry Ingestion
    participant AL as Audit Log
    
    Note over UI,AL: Complete Trip Lifecycle Flow
    
    %% Trip Creation
    UI->>+AG: CreateTrip(origin, destination, requirements)
    AG->>+TS: CreateTrip(tripRequest)
    TS->>TS: Validate trip parameters
    TS->>+PE: EvaluatePolicy(tripContext)
    PE->>PE: Execute policy rules
    PE->>AL: Log policy evaluation
    PE->>-TS: PolicyResult(allowed, constraints)
    
    alt Policy Allows Trip
        TS->>TS: Create trip record
        TS->>-AG: TripCreated(tripId, status=CREATED)
        AG->>-UI: TripResponse(tripId)
        
        %% Route Planning
        TS->>+RS: CalculateRoute(origin, destination, constraints)
        RS->>RS: Optimize route with constraints
        RS->>-TS: RouteCalculated(routeId, path, duration)
        
        %% Vehicle Assignment
        TS->>+DS: AssignVehicle(tripId, requirements)
        DS->>+FM: GetAvailableVehicles(requirements)
        FM->>-DS: AvailableVehicles(vehicleList)
        DS->>DS: Optimize assignment
        DS->>+PE: EvaluatePolicy(assignmentContext)
        PE->>AL: Log assignment policy check
        PE->>-DS: PolicyResult(allowed, vehicleId)
        DS->>-TS: VehicleAssigned(vehicleId, estimatedStart)
        
        %% Trip Dispatch
        TS->>+VA: DispatchTrip(tripId, routeId, instructions)
        VA->>VA: Validate trip parameters
        VA->>-TS: TripAccepted(estimatedArrival)
        TS->>TS: Update trip status to DISPATCHED
        
        %% Trip Execution
        VA->>VA: Begin trip execution
        loop During Trip
            VA->>+TI: SendTelemetry(vehicleState, location, progress)
            TI->>TI: Validate and process telemetry
            TI->>-VA: TelemetryAck()
            
            VA->>+TS: UpdateTripProgress(tripId, progress)
            TS->>-VA: ProgressAck()
            
            %% Policy Monitoring
            TS->>+PE: MonitorCompliance(tripId, currentState)
            PE->>AL: Log compliance check
            PE->>-TS: ComplianceStatus(compliant, violations)
        end
        
        %% Trip Completion
        VA->>+TS: CompleteTtrip(tripId, summary)
        TS->>TS: Update trip status to COMPLETED
        TS->>AL: Log trip completion
        TS->>-VA: TripCompletionAck()
        
    else Policy Denies Trip
        PE->>AL: Log policy denial
        TS->>-AG: TripDenied(reason, policyViolation)
        AG->>-UI: ErrorResponse(POLICY_VIOLATION, reason)
    end
