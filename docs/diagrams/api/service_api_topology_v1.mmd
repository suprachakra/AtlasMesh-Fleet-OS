flowchart TB
 subgraph subGraph0["API Specifications"]
        FleetAPI["ğŸ“„ Fleet Manager API<br>OpenAPI 3.0<br>/api/fleet/openapi.yaml"]
        VehicleAPI["ğŸ“„ Vehicle Gateway API<br>OpenAPI 3.0<br>/api/vehicle/openapi.yaml"]
        PolicyAPI["ğŸ“„ Policy Engine API<br>OpenAPI 3.0<br>/api/policy/openapi.yaml"]
        AuthAPI["ğŸ“„ Auth Service API<br>OpenAPI 3.0<br>/api/auth/openapi.yaml"]
        TelemetryAPI["ğŸ“„ Telemetry API<br>OpenAPI 3.0<br>/api/telemetry/openapi.yaml"]
        AnalyticsAPI["ğŸ“„ Analytics API<br>OpenAPI 3.0<br>GraphQL Schema"]
  end
 subgraph subGraph1["gRPC Contracts"]
        FleetProto["ğŸ“‹ fleet_manager.proto<br>Service Definitions"]
        PolicyProto["ğŸ“‹ policy_engine.proto<br>Policy Evaluation"]
        TelemetryProto["ğŸ“‹ telemetry.proto<br>Data Ingestion"]
        PredMaintProto["ğŸ“‹ predictive_maintenance.proto<br>ML Predictions"]
  end
 subgraph subGraph2["Event Schemas"]
        VehicleEvents["ğŸ“¨ vehicle-events-v1.avsc<br>Avro Schema"]
        CommandEvents["ğŸ“¨ command-events-v1.avsc<br>Avro Schema"]
        TelemetryEvents["ğŸ“¨ telemetry-events-v1.avsc<br>Avro Schema"]
        FleetEvents["ğŸ“¨ fleet-events-v1.avsc<br>Avro Schema"]
  end
 subgraph subGraph3["API Versioning"]
        V1["ğŸ”¢ v1 APIs<br>Current Stable<br>Backward Compatible"]
        V2["ğŸ”¢ v2 APIs<br>Future Version<br>Breaking Changes"]
        Deprecation["âš ï¸ Deprecation Policy<br>6 months notice<br>Migration guides"]
  end
 subgraph Security["Security"]
        JWT["ğŸ”‘ JWT Tokens<br>RS256 Signing<br>Short Expiration"]
        OAuth["ğŸ” OAuth 2.0<br>Authorization Code<br>PKCE for Mobile"]
        APIKeys["ğŸ—ï¸ API Keys<br>Third Party Access<br>Rate Limited"]
        mTLS["ğŸ”’ mTLS<br>Service-to-Service<br>Certificate Auth"]
  end
 subgraph subGraph5["Rate Limiting"]
        UserLimits["ğŸ‘¤ User Limits<br>1000 req/min<br>Per JWT token"]
        ServiceLimits["âš™ï¸ Service Limits<br>10000 req/min<br>Per service"]
        ThirdPartyLimits["ğŸ”— 3rd Party Limits<br>100 req/min<br>Per API key"]
  end
 subgraph subGraph6["Gateway Features"]
        LoadBalancing["âš–ï¸ Load Balancing<br>Round Robin<br>Health Checks"]
        CircuitBreaker["ğŸ”Œ Circuit Breaker<br>Fail Fast<br>Auto Recovery"]
        RequestLogging["ğŸ“ Request Logging<br>Audit Trail<br>Performance Metrics"]
        CORS["ğŸŒ CORS Policy<br>Allowed Origins<br>Preflight Handling"]
  end
    WebUI["ğŸ–¥ï¸ Control Center UI<br>React SPA"] -- HTTPS/REST<br>JWT Auth --> APIGateway["ğŸšª API Gateway<br>Port: 8080<br>Go + Gin"]
    MobileApp["ğŸ“± Mobile App<br>React Native"] -- "HTTPS/REST<br>OAuth 2.0" --> APIGateway
    ThirdParty["ğŸ”— Third Party<br>Integrators"] -- HTTPS/REST<br>API Keys --> APIGateway
    APIGateway -- gRPC<br>Service Mesh --> FleetMgr["ğŸš› Fleet Manager<br>Port: 8081<br>REST + gRPC"]
    APIGateway -- "gRPC + WebSocket<br>Real-time" --> VehicleGW["ğŸš— Vehicle Gateway<br>Port: 8082<br>WebSocket + REST"]
    APIGateway -- gRPC<br>Policy Eval --> PolicyEngine["ğŸ“‹ Policy Engine<br>Port: 8083<br>gRPC + REST"]
    APIGateway -- gRPC<br>Token Validation --> AuthService["ğŸ” Auth Service<br>Port: 8084<br>REST + JWT"]
    APIGateway -- gRPC<br>Telemetry Query --> TelemetryIngest["ğŸ“¡ Telemetry Ingest<br>Port: 8085<br>gRPC + Kafka"]
    APIGateway -- REST + GraphQL<br>Analytics --> Analytics["ğŸ“Š Analytics Engine<br>Port: 8086<br>REST + GraphQL"]
    APIGateway -- REST<br>Lineage Query --> DataLineage["ğŸ” Data Lineage<br>Port: 8087<br>REST + Neo4j"]
    APIGateway -- REST<br>Model Management --> MLPipeline["ğŸ§  ML Pipeline<br>Port: 8088<br>REST + MLflow"]
    APIGateway -- gRPC<br>Maintenance Pred --> PredMaint["ğŸ”§ Predictive Maintenance<br>Port: 8089<br>gRPC + TensorFlow"]
    APIGateway -- REST<br>Simulation --> DigitalTwin["ğŸ­ Digital Twin<br>Port: 8090<br>REST + CARLA"]
    APIGateway -- REST<br>Compliance --> UAEGov["ğŸ‡¦ğŸ‡ª UAE Government<br>Port: 8091<br>REST + SOAP"]
    APIGateway -- REST<br>Weather Data --> WeatherFusion["ğŸŒ¤ï¸ Weather Fusion<br>Port: 8092<br>REST + HTTP"]
    APIGateway -- REST<br>Map Updates --> MapContract["ğŸ—ºï¸ Map Data Contract<br>Port: 8093<br>REST + PostGIS"]
    FleetMgr -- gRPC<br>Policy Check --> PolicyEngine
    FleetMgr -- gRPC<br>Vehicle Status --> VehicleGW
    FleetMgr -- Kafka<br>Fleet Events --> EventBus["ğŸ“¨ Event Bus<br>Kafka Cluster<br>Ports: 9092-9094"]
    VehicleGW -- Kafka<br>Telemetry Stream --> TelemetryIngest
    VehicleGW -- Kafka<br>Command Events --> EventBus
    VehicleGW -- WebSocket<br>Vehicle Comms --> VehicleGW
    TelemetryIngest -- Kafka<br>Processed Data --> Analytics
    TelemetryIngest -- gRPC<br>Data Lineage --> DataLineage
    Analytics -- REST<br>ML Features --> MLPipeline
    MLPipeline -- gRPC<br>Trained Models --> PredMaint
    PredMaint -- gRPC<br>Maintenance Alerts --> FleetMgr
    UAEGov -- HTTPS/REST<br>Gov APIs --> UAEGovSys["ğŸ›ï¸ UAE Government<br>Systems"]
    WeatherFusion -- HTTPS/REST<br>Weather APIs --> WeatherAPI["ğŸŒ Weather APIs<br>Multi-source"]
    MapContract -- HTTPS/REST<br>Map APIs --> MapProviders["ğŸ—ºï¸ Map Providers<br>HD Maps"]
    Monitoring["ğŸ“ˆ Monitoring<br>Prometheus: 9090<br>Grafana: 3000"] -- HTTP<br>Metrics Scraping --> APIGateway
    Monitoring -- HTTP<br>Health Checks --> FleetMgr
    Monitoring -- HTTP<br>Service Metrics --> VehicleGW
    Monitoring -- JMX<br>Kafka Metrics --> EventBus

     FleetAPI:::spec
     VehicleAPI:::spec
     PolicyAPI:::spec
     AuthAPI:::spec
     TelemetryAPI:::spec
     AnalyticsAPI:::spec
     VehicleEvents:::Class_04
     CommandEvents:::Class_04
     TelemetryEvents:::Class_04
     FleetEvents:::Class_04
     V1:::client
     V2:::spec
     Deprecation:::client
     JWT:::Rose
     OAuth:::Rose
     APIKeys:::Rose
     mTLS:::Rose
     UserLimits:::Ash
     ServiceLimits:::Ash
     ThirdPartyLimits:::Ash
     LoadBalancing:::gateway
     CircuitBreaker:::gateway
     RequestLogging:::gateway
     CORS:::gateway
     WebUI:::client
     APIGateway:::gateway
     MobileApp:::client
     ThirdParty:::client
     FleetMgr:::coreService
     VehicleGW:::coreService
     PolicyEngine:::coreService
     AuthService:::coreService
     TelemetryIngest:::dataService
     Analytics:::dataService
     DataLineage:::dataService
     MLPipeline:::mlService
     PredMaint:::mlService
     DigitalTwin:::mlService
     UAEGov:::integration
     WeatherFusion:::integration
     MapContract:::integration
     EventBus:::infrastructure
     UAEGovSys:::external
     WeatherAPI:::external
     MapProviders:::external
     Monitoring:::infrastructure
    classDef coreService fill:#e8f5e8,stroke:#2e7d32,stroke-width:2px
    classDef dataService fill:#f3e5f5,stroke:#7b1fa2,stroke-width:2px
    classDef mlService fill:#fff8e1,stroke:#f57f17,stroke-width:2px
    classDef integration fill:#fce4ec,stroke:#c2185b,stroke-width:2px
    classDef infrastructure fill:#f1f8e9,stroke:#558b2f,stroke-width:2px
    classDef external fill:#fafafa,stroke:#616161,stroke-width:2px
    classDef gateway fill:#fff3e0, stroke:#e65100, stroke-width:3px
    classDef spec fill:#e3f2fd, stroke:#1565c0, stroke-width:1px
    classDef client fill:#e1f5fe, stroke:#01579b, stroke-width:2px
    classDef Rose stroke-width:1px, stroke-dasharray:none, stroke:#FF5978, fill:#FFDFE5, color:#8E2236
    classDef Ash stroke-width:1px, stroke-dasharray:none, stroke:#999999, fill:#EEEEEE, color:#000000
    classDef Class_03 fill:#c4b1b3, color:#7d5f62, stroke:#7d5f62
    classDef Class_04 fill:#e5dddd, stroke:#7d5f62, color:#7d5f62
    style subGraph6 fill:transparent
    style subGraph5 fill:transparent
    style Security fill:transparent
    style subGraph3 fill:transparent
    style subGraph2 fill:transparent
    style subGraph1 fill:transparent
    style subGraph0 fill:transparent
